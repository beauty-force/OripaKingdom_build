import{H as A,L as C,a as k,r as g,o as l,c as d,b as v,w as x,F as S,d as n,g as L,h as c,t as P,J as R,a4 as T,n as u}from"./app.6db07015.js";import{U as N}from"./UserLayout.56de5201.js";import{_ as E}from"./_plugin-vue_export-helper.cdc0426e.js";import{r as O}from"./ArrowLeftIcon.0e195efe.js";import"./toastify.24a0c38e.js";const I=3,U="merchant.com.cityoripa",j="apple-pay-button",B=route("apple_pay_validate"),V={components:{Head:A,AdminLayout:N,Link:C,ArrowLeftIcon:O},props:{errors:Object,auth:Object,point:Object,is_admin:Number,amount:Number,amount_str:String,testOrLive:String,coupon_id:Number,no_applepay_setting:String,no_applepay_support:String,supported_pay_type:Object},data(){return{is_busy:!1,check_agree:!1,order_id:null,access_id:null,payment_stage:"register",fincode:null,fincode_ui:null,card_pay_link:"#",va_account_name:"",va_account_number:"",va_branch_name:"",va_branch_code:"",billing_total_amount:0}},mounted(){},methods:{submit(){},format_number(o){return String(o).replace(/(.)(?=(\d{3})+$)/g,"$1,")},paymentRegister(o){if(!this.check_agree){alert("\u500B\u4EBA\u60C5\u5831\u306E\u53D6\u308A\u6271\u3044\u306B\u540C\u610F\u3057\u3066\u304F\u3060\u3055\u3044\uFF01");return}if(!this.is_busy){if(!this.supported_pay_type.includes(o)){alert("\u3053\u306E\u652F\u6255\u3044\u65B9\u6CD5\u306F\u8FD1\u3005\u5B9F\u88C5\u3055\u308C\u308B\u4E88\u5B9A\u3067\u3059\u3002");return}this.is_busy=!0,k.post(this.is_admin==1?route("test.user.point.paymentRegister"):route("user.point.paymentRegister"),{id:this.point.id,pay_type:o,coupon_id:this.coupon_id}).then(e=>{e.data.status==0?alert(e.data.message):o=="Card"||o=="Paypay"||o=="Konbini"||o=="Virtualaccount"?e.data.status&&(window.location.href=e.data.link_url):o=="Applepay"&&(this.payment_stage="Applepay",this.$nextTick(()=>{const s=document.getElementById("applepay_container");s.innerHTML="",window.ApplePaySession?ApplePaySession.canMakePaymentsWithActiveCard(U).then(t=>{if(t){const a=document.createElement("button");a.setAttribute("id",j),a.setAttribute("lang","ja-JP");const y="buy",b="black";a.setAttribute("style",`-webkit-appearance: -apple-pay-button; -apple-pay-button-type: ${y}; -apple-pay-button-style: ${b};`),s.appendChild(a),a.addEventListener("click",f=>{const i={countryCode:"JP",currencyCode:"JPY",supportedNetworks:["visa","masterCard","jcb","amex"],merchantCapabilities:["supports3DS"],total:{label:e.data.response.label,amount:e.data.response.amount}},r=new ApplePaySession(I,i);r.onvalidatemerchant=_=>{const m=_.validationURL;fetch(B,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({validationURL:m})}).then(p=>p.json()).then(p=>{r.completeMerchantValidation(p)})},r.oncancel=_=>{},r.onpaymentauthorized=_=>{const m=_.payment.token;r.completePayment(ApplePaySession.STATUS_SUCCESS);const p=btoa(JSON.stringify(m.paymentData));k.post(this.is_admin==1?route("test.user.point.paymentExecute"):route("user.point.paymentExecute"),{pay_type:o,order_id:e.data.response.id,access_id:e.data.response.access_id,token:p}).then(h=>{h.data.status==0?alert(h.data.message):window.location.href=route(h.data.redirect_uri)})},r.begin()})}else s.innerHTML=this.no_applepay_setting}):s.innerHTML=this.no_applepay_support})),this.is_busy=!1})}}}},D={class:"py-4 text-neutral-300 flex-1 flex flex-col items-center justify-around gap-4 relative"},H={class:"text-center"},M={class:"text-lg font-bold"},J={class:"text-lg"},F=n("br",null,null,-1),K=n("br",null,null,-1),Y={key:1,class:"flex items-center gap-2"},z={for:"check-agree"},q=n("span",null,"\u500B\u4EBA\u60C5\u5831\u306E\u53D6\u308A\u6271\u3044\u306B\u540C\u610F\u3059\u308B",-1),W=["href"],G={key:0,class:"flex justify-center w-full pay-method flex-col items-center gap-5 my-3"},Q=["disabled"],X=["disabled"],Z=["disabled"],$=["disabled"],ee=["disabled"],te={key:1,class:"text-center",id:"applepay_container"};function ne(o,e,s,w,t,a){const y=g("Head"),b=g("ArrowLeftIcon"),f=g("AdminLayout");return l(),d(S,null,[v(y,{title:"\u6C7A\u6E08\u767B\u9332"}),v(f,null,{default:x(()=>[n("div",D,[n("div",H,[t.payment_stage!="register"?(l(),L(b,{key:0,onClick:e[0]||(e[0]=i=>t.payment_stage="register"),class:"absolute left-2 top-5 float-left text-white w-9 p-1.5 hover:bg-gray-600 rounded-full cursor-pointer"})):c("",!0),n("h1",M,P(a.format_number(s.point.point))+" \u30DD\u30A4\u30F3\u30C8\u8CFC\u5165 ",1),n("span",J,"\xA5"+P(s.amount_str),1),F,K,t.payment_stage=="register"?(l(),d("div",Y,[R(n("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>t.check_agree=i),type:"checkbox",id:"check-agree",name:"check-agree",class:"text-blue-600 focus:ring-0"},null,512),[[T,t.check_agree]]),n("label",z,[q,n("a",{href:o.route("main.privacy_police"),class:"ml-2 text-blue-600 underline underline-offset-4"},"\u898B\u308B",8,W)])])):c("",!0)]),t.payment_stage=="register"?(l(),d("div",G,[n("button",{class:u([{"opacity-25":t.is_busy},s.supported_pay_type.includes("Card")?"border-green-500":"border-rose-500","rounded-lg border-2 bg-white/10 h-12 p-2 w-56 hover:bg-white/20"]),disabled:t.is_busy,onClick:e[2]||(e[2]=i=>a.paymentRegister("Card"))}," \u30AF\u30EC\u30B8\u30C3\u30C8\u30AB\u30FC\u30C9\u6C7A\u6E08 ",10,Q),n("button",{class:u([{"opacity-25":t.is_busy},s.supported_pay_type.includes("Virtualaccount")?"border-green-500":"border-rose-500","rounded-lg border-2 bg-white/10 h-12 p-2 w-56 hover:bg-white/20"]),disabled:t.is_busy,onClick:e[3]||(e[3]=i=>a.paymentRegister("Virtualaccount"))}," \u9280\u884C\u632F\u8FBC ",10,X),n("button",{class:u([{"opacity-25":t.is_busy},s.supported_pay_type.includes("Applepay")?"border-green-500":"border-rose-500","rounded-lg border-2 bg-white/10 h-12 p-2 w-56 hover:bg-white/20"]),disabled:t.is_busy,onClick:e[4]||(e[4]=i=>a.paymentRegister("Applepay"))}," Apple Pay ",10,Z),s.supported_pay_type.includes("Paypay")?(l(),d("button",{key:0,class:u([{"opacity-25":t.is_busy},s.supported_pay_type.includes("Paypay")?"border-green-500":"border-rose-500","rounded-lg border-2 bg-white/10 h-12 p-2 w-56 hover:bg-white/20"]),disabled:t.is_busy,onClick:e[5]||(e[5]=i=>a.paymentRegister("Paypay"))}," PayPay ",10,$)):c("",!0),n("button",{class:u([{"opacity-25":t.is_busy},s.supported_pay_type.includes("Konbini")?"border-green-500":"border-rose-500","rounded-lg border-2 bg-white/10 h-12 p-2 w-56 hover:bg-white/20"]),disabled:t.is_busy,onClick:e[6]||(e[6]=i=>a.paymentRegister("Konbini"))}," \u30B3\u30F3\u30D3\u30CB\u6C7A\u6E08 ",10,ee)])):c("",!0),t.payment_stage=="Applepay"?(l(),d("div",te)):c("",!0)])]),_:1})],64)}const le=E(V,[["render",ne]]);export{le as default};
